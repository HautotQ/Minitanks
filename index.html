<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Duel 2 Joueurs</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #111;
        color: #fff;
        font-family: Arial, sans-serif;
    }
    canvas {
        display: block;
        background: #222;
        margin: 0 auto;
    }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const playerSize = 40;
const speed = 5;
const bulletSpeed = 7;

let players = [
    {x: 100, y: 300, color: 'red', up: 'w', down: 's', left: 'a', right: 'd', shoot: ' ', bullets: [], score: 0},
    {x: 660, y: 300, color: 'blue', up: 'ArrowUp', down: 'ArrowDown', left: 'ArrowLeft', right: 'ArrowRight', shoot: 'Enter', bullets: [], score: 0}
];

let keysPressed = {};

document.addEventListener('keydown', e => keysPressed[e.key] = true);
document.addEventListener('keyup', e => keysPressed[e.key] = false);

function update() {
    players.forEach(player => {
        if (keysPressed[player.up] && player.y > 0) player.y -= speed;
        if (keysPressed[player.down] && player.y < canvas.height - playerSize) player.y += speed;
        if (keysPressed[player.left] && player.x > 0) player.x -= speed;
        if (keysPressed[player.right] && player.x < canvas.width - playerSize) player.x += speed;
        if (keysPressed[player.shoot]) shoot(player);
        
        player.bullets.forEach((bullet, index) => {
            bullet.x += bullet.dx;
            bullet.y += bullet.dy;
            
            // Collision avec l'autre joueur
            let opponent = players.find(p => p !== player);
            if (bullet.x < opponent.x + playerSize &&
                bullet.x + 10 > opponent.x &&
                bullet.y < opponent.y + playerSize &&
                bullet.y + 10 > opponent.y) {
                opponent.x = Math.random() * (canvas.width - playerSize);
                opponent.y = Math.random() * (canvas.height - playerSize);
                player.score++;
                player.bullets.splice(index, 1);
            }

            // Suppression si hors Ã©cran
            if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
                player.bullets.splice(index, 1);
            }
        });
    });
}

function shoot(player) {
    // Limite de cadence
    if (!player.canShoot) return;
    player.bullets.push({x: player.x + playerSize/2 - 5, y: player.y + playerSize/2 - 5, dx: player === players[0] ? bulletSpeed : -bulletSpeed, dy: 0});
    player.canShoot = false;
    setTimeout(() => player.canShoot = true, 300);
}

players.forEach(p => p.canShoot = true);

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    players.forEach(player => {
        // Joueur
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, playerSize, playerSize);

        // Balles
        ctx.fillStyle = 'yellow';
        player.bullets.forEach(bullet => ctx.fillRect(bullet.x, bullet.y, 10, 10));

        // Score
        ctx.fillStyle = player.color;
        ctx.font = '20px Arial';
        ctx.fillText(`Score: ${player.score}`, player === players[0] ? 10 : canvas.width - 110, 30);
    });
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
