<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Duel Manettes</title>
<style>
body { margin:0; background:#111; color:#fff; font-family:Arial; overflow:hidden;}
canvas { display:block; margin:0 auto; background:#222; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const playerSize = 40;
const speed = 5;
const bulletSpeed = 7;

let players = [
    {x:100, y:300, color:'red', bullets:[], score:0},
    {x:660, y:300, color:'blue', bullets:[], score:0}
];

function shoot(player) {
    if(!player.canShoot) return;
    player.bullets.push({x:player.x+playerSize/2-5, y:player.y+playerSize/2-5, dx:player===players[0]?bulletSpeed:-bulletSpeed, dy:0});
    player.canShoot=false;
    setTimeout(()=>player.canShoot=true,300);
}

players.forEach(p=>p.canShoot=true);

function update() {
    const gamepads = navigator.getGamepads();
    players.forEach((player,index)=>{
        const gp = gamepads[index];
        if(gp){
            // Axes 0 et 1 : stick gauche X/Y
            player.x += gp.axes[0]*speed;
            player.y += gp.axes[1]*speed;
            // Bouton 0 (souvent A) pour tirer
            if(gp.buttons[0].pressed) shoot(player);
        }

        // Limites du canvas
        player.x = Math.max(0, Math.min(canvas.width - playerSize, player.x));
        player.y = Math.max(0, Math.min(canvas.height - playerSize, player.y));

        // Mouvements des balles
        player.bullets.forEach((b,indexB)=>{
            b.x += b.dx;
            b.y += b.dy;
            const opponent = players.find((p,i)=>i!==index);
            if(b.x < opponent.x+playerSize && b.x+10 > opponent.x &&
               b.y < opponent.y+playerSize && b.y+10 > opponent.y){
                opponent.x=Math.random()*(canvas.width-playerSize);
                opponent.y=Math.random()*(canvas.height-playerSize);
                player.score++;
                player.bullets.splice(indexB,1);
            }
            if(b.x<0 || b.x>canvas.width || b.y<0 || b.y>canvas.height){
                player.bullets.splice(indexB,1);
            }
        });
    });
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    players.forEach(player=>{
        ctx.fillStyle=player.color;
        ctx.fillRect(player.x,player.y,playerSize,playerSize);
        ctx.fillStyle='yellow';
        player.bullets.forEach(b=>ctx.fillRect(b.x,b.y,10,10));
        ctx.fillStyle=player.color;
        ctx.font='20px Arial';
        ctx.fillText(`Score: ${player.score}`,player===players[0]?10:canvas.width-110,30);
    });
}

function gameLoop(){
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

window.addEventListener("gamepadconnected", (e)=>{
    console.log("Manette connect√©e:", e.gamepad);
});

gameLoop();
</script>
</body>
</html>
